<!DOCTYPE html>
<head>
<meta charset="utf-8">
<link href="style.css" rel="stylesheet" type="text/css">
<title>SF February Noise Complaints</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">

<!-- Load Font Awesome 5 (free) icons -->
<script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://d3js.org/d3-zoom.v1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-dsv/1.0.8/d3-dsv.min.js"></script>
<script src="https://d3js.org/d3-hierarchy.v1.min.js"></script>
</head>

<body>
<!--
  hard-code the svg and various g layers so that even if the streets are loaded
  and drawn last, they will still show up behind the symbols
-->
<section class="hero is-primary is-bold">
  <div class="hero-body">
    <div class="container">
      <!-- TODO: Change title -->
      <h1 class="title">Nick Kebbas's Website</h1>
      <!-- TODO: Change subtitle -->
      <h2 class="subtitle">Homework 4 Website</h2>
    </div>
  </div>
</section>

<nav class="navbar is-light" role="navigation" aria-label="main navigation">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item is-active" href="../../index.html">
        <span class="icon"><i class="fas fa-home"></i></span>
        <span>Home</span>
      </a>

      <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="main-menu">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="main-menu" class="navbar-menu has-text-weight-medium">
      <!-- Left navbar items -->
      <div class="navbar-start">

        <!-- TODO: Modify or remove dropdown -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">
            Visualizations
          </a>

          <div class="navbar-dropdown">
            <a class="navbar-item" href="">
              <span class="icon"><i class="fas fa-map"></i></span>
              <span> SF February Noise Reports</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>
<!-- End page navigation -->
<section class="section">
  <div class="container">
<div class="content">
  <h2> License and Permissioning</h2>
  <p>Data is in the public domain, as noted here: https://data.sfgov.org/Public-Safety/Fire-Department-Calls-for-Service/nuek-vuh3/data</p>
  <h2>Data Set Information</h2>
  <p>The data set is about 40,000 rows. We accessed this data on April 19, 2020.<p>
  <div>
    <h2>January 1, 2020 - March, 2020 Potentially Life Threatening Incidents across neighborhoods, furher grouped by type.</h2>
    <h3>Data Summary</h3>
    <h3>Conclusions</h3>
    <h3>Interactivity</h3>
    <br>
  </div>
</div>
</div>

<figure>
<div id="my_dataviz"></div>

  <figcaption>
    Source: <a href="https://data.sfgov.org/Public-Safety/Police-Department-Incident-Reports-2018-to-Present/wg3w-h783">Fire Department</a> (<a href="https://data.sfgov.org/Geographic-Locations-and-Boundaries/Analysis-Neighborhoods/p5b7-5n3h">Neighborhoods</a>, <a href="https://data.sfgov.org/Geographic-Locations-and-Boundaries/Streets-Active-and-Retired/3psu-pn9h">Streets</a>)
  </figcaption>
</figure>

<script>
let margin = {top: 10, right: 10, bottom: 10, left: 10},
  width = 960 - margin.left - margin.right,
  height = 500 - margin.top - margin.bottom;

let svg = d3.select("#my_dataviz")
.append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
.append("g")
  .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");

// wragle the data
let objectsArray = []
let map = new Map();
let neighborhoods = [];
d3.csv('calls_for_service_hw4_adjusted.csv')
  .then(function(data) {
      // data is now whole data set
      let previousRow = {}
      previousRow.parent = "";
      previousRow.value = "San Francisco"
      previousRow.id = "1"
      // add child iteratively
      previousRow.child = "1";
      objectsArray.push(previousRow)
      for (let i = 0; i < 20; i++) {
        row = {}
        let neighboorhood = "Neighborhooods - Analysis Boundaries"
        row.id=data[i]["Call Number"]
        row.value=data[i]["Neighborhooods - Analysis Boundaries"]
        if (map.has(row.value)) {
          map.set(row.value, map.get(row.value)+1);
        } else {
          map.set(row.value, 1);
        }
        row.child=data[i]["Call Number"]
        row.parent = previousRow.id
        objectsArray.push(row)
      }
      // for each neighboorhood in the map, make a new node,
      // make parent san francisco
      map.forEach(function(value, key) {
        console.log(value)
        row = {}
        row.value=data[i]["Neighborhooods - Analysis Boundaries"]
        row.parent=previousRow.id
        objectsArray.push(row)
        
      })
      console.log(map)
      let childColumn = "child"
      let parentColumn = "parent"

      console.log(objectsArray);
      console.log(childColumn);
      console.log(parentColumn);

      let stratify = d3.stratify().id(d => d[childColumn]).parentId(d => d[parentColumn])
      console.log(stratify)
      let root = stratify(objectsArray)
      console.log(root.data)
      console.log(root.children)
      root.sum(function(d) { return +d.id })   // Compute the numeric value for each entity
      d3.treemap()
        .size([width, height])
        .paddingTop(28)
        .paddingRight(7)
        .paddingInner(3)      // Padding between each rectangle
        //.paddingOuter(6)
        //.padding(20)
        (root)

        // prepare a color scale
        var color = d3.scaleOrdinal()
          .domain(neighborhoods)
          .range(["red", "orange", "green", "blue", "purple"])

        // And a opacity scale
        var opacity = d3.scaleLinear()
          .domain([10, 30])
          .range([.5,1])

console.log(root.leaves())
 // use this information to add rectangles:
   svg
     .selectAll("rect")
     .data(root.leaves())
     .enter()
     .append("rect")
       .attr('x', function (d) { return d.x0; })
       .attr('y', function (d) { return d.y0; })
       .attr('width', function (d) { return d.x1 - d.x0; })
       .attr('height', function (d) { return d.y1 - d.y0; })
       .style("stroke", "black")
       .style("fill", function(d){ return color(map.get(d.data.value))} )
       .style("opacity", function(d){ return opacity(d.data.id)})

   // and to add the text labels
   svg
       .selectAll("text")
       .data(root.leaves())
       .enter()
       .append("text")
         .attr("x", function(d){ return d.x0+5})    // +10 to adjust position (more right)
         .attr("y", function(d){ return d.y0+20})    // +20 to adjust position (lower)
         .text(function(d){ return d.data.value})
         .attr("font-size", "19px")
         .attr("fill", "white")

         svg
          .selectAll("vals")
          .data(root.leaves())
          .enter()
          .append("text")
            .attr("x", function(d){ return d.x0+5})    // +10 to adjust position (more right)
            .attr("y", function(d){ return d.y0+35})    // +20 to adjust position (lower)
            .text(function(d){ return d.data.value })
            .attr("font-size", "11px")
            .attr("fill", "white")

        // Add title for the 3 groups
        svg
          .selectAll("titles")
          .data(root.descendants().filter(function(d){return d.depth==1}))
          .enter()
          .append("text")
            .attr("x", function(d){ return d.x0})
            .attr("y", function(d){ return d.y0+21})
            .text(function(d){ return d.data.name })
            .attr("font-size", "19px")
            .attr("fill",  function(d){ return color(d.data.value)} )

        // Add title for the 3 groups
        svg
          .append("text")
            .attr("x", 0)
            .attr("y", 14)    // +20 to adjust position (lower)
            .text("Three group leaders and 14 employees")
            .attr("font-size", "19px")
            .attr("fill",  "grey" )
    })

  .catch(function(error){
     // handle error
  })


</script>

<style>
.legend rect{
  background-color: white;
  fill:white;
  stroke:black;
  opacity:0.8;
}

  #tooltip {
    stroke: none;
    background-color: white;
    fill:white;
    stroke:black;
  }
</style>
</body>
